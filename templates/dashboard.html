{% extends "base.html" %}
{% block content %}
<h2 class="text-2xl font-semibold mb-4">Dashboard</h2>

<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
  <div class="bg-white p-4 rounded shadow">
    <h3 class="font-semibold">Total Collected</h3>
    <p class="text-2xl font-bold">₹{{ total_collected }}</p>
  </div>
  <div class="bg-white p-4 rounded shadow">
    <h3 class="font-semibold">Total Outstanding</h3>
    <p class="text-2xl font-bold text-red-600">₹{{ total_outstanding }}</p>
  </div>
  <div class="bg-white p-4 rounded shadow">
    <h3 class="font-semibold">Recent Students</h3>
    <ul class="mt-2 space-y-1">
      {% for s in latest_students %}
        <li>{{ s.name }} — {{ s.class }}</li>
      {% endfor %}
    </ul>
  </div>
</div>

<div class="mt-6 bg-white p-4 rounded shadow">
  <h3 class="font-semibold mb-2">Class-wise collected vs outstanding</h3>
  <canvas id="classChart" height="120"></canvas>
</div>

<script>
fetch("{{ url_for('api_class_stats') }}")
  .then(r => r.json())
  .then(data => {
    const ctx = document.getElementById('classChart').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: data.labels,
        datasets: [
          { label: 'Collected', data: data.collected },
          { label: 'Outstanding', data: data.outstanding }
        ]
      },
      options: {
        responsive: true,
        interaction: { mode: 'index', intersect: false },
        scales: { y: { beginAtZero: true } }
      }
    })
  })
</script>
{% endblock %}
